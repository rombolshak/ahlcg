branch=$(git branch --show-current)
pushedRef=$(git ls-remote --heads origin $branch)
mainRef=$(git ls-remote --heads origin main)
ref=$(echo ${pushedRef:-$mainRef} | awk '{print $1}')

if git diff --name-only --quiet $ref HEAD -- frontend/src; then
  echo "No changes in frontend folder. Skipping frontend-specific tasks."
else
  echo "Changes detected in frontend folder. Running frontend-specific tasks..."
  cd frontend
  npm run ci:all
  cd ..
fi

if git diff --name-only --quiet $ref HEAD -- backend/; then
  echo "No changes in backend folder. Skipping backend-specific tasks."
else
  echo "Changes detected in backend folder. Running backend-specific tasks..."
  cd backend
  dotnet build
  dotnet test
  cd ..
fi
