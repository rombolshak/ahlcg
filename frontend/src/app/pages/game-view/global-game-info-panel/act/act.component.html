<ng-container *transloco="let t">
  <div class="peer text-center">
    <p class="-my-1 font-[ArnoPro] text-sm/4">
      {{ t("global_game_info.act") }} {{ act().stage }}
    </p>
    <p class="font-[Conkordia] text-xl">
      {{ t(title()!) }}
    </p>
  </div>

  @for (objective of act().objectives; track $index) {
    <p
      data-testId="objective"
      [innerHTML]="t(objective.description) | withAhSymbols"
    ></p>
    @switch (objective.type) {
      @case ("health") {
        <ah-single-bar
          class="mb-2 h-5 w-full"
          goodColor="bg-health-damaged"
          badColor="bg-slate-950"
          [current]="objective.currentValue"
          [max]="objective.startValue || objective.requiredValue"
        />
      }
      @default {
        <!--suppress JSUnusedLocalSymbols -->
        <div
          class="mb-2 grid grid-flow-col gap-1"
          [ngClass]="
            maxLines()[$index] === 1
              ? 'grid-rows-1'
              : maxLines()[$index] === 2
                ? 'grid-rows-2'
                : 'grid-rows-3'
          "
        >
          @for (_ of [].constructor(objective.currentValue); track $index) {
            <img
              width="36"
              height="36"
              alt="objective token"
              class="flex-none brightness-125"
              [ngSrc]="imageService.getUrl(['card-overlay', objective.type])"
            />
          }
          @for (_ of [].constructor(emptySlots()[$index]); track $index) {
            <img
              width="36"
              height="36"
              alt="objective token"
              class="flex-none brightness-25"
              [ngSrc]="imageService.getUrl(['card-overlay', objective.type])"
            />
          }
        </div>
      }
    }
  }
</ng-container>

<ah-card-details-text
  class="absolute top-[2.5rem] h-0 w-full rounded px-2 opacity-0 peer-hover:h-auto peer-hover:opacity-100"
  [showTitle]="false"
  [card]="act()"
  [ngClass]="hostClasses()"
/>
